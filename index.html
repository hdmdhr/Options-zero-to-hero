<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœŸæƒé›¶åŸºç¡€ï¼šä»å°ç™½åˆ°ç”šè‡³ä¸æƒ³ä¹°æ­£è‚¡ - ç¬¬ä¸€é›†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
    <!-- Marked library for parsing Markdown in chat responses -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Chosen Palette: "Neon FinTech" (Vibrant/Energetic)
         Primary: Indigo-600 (#4F46E5)
         Secondary: Pink-500 (#EC4899)
         Accent: Cyan-500 (#06B6D4)
         Bg: Gray-100 (#F3F4F6)
    -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&family=Roboto:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans SC', 'Noto Sans JP', 'Roboto', sans-serif;
            background-color: #F3F4F6;
            color: #1F2937;
        }

        /* Chart Container Styling - MANDATORY Requirements */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 650px; /* Max width constraint */
            margin-left: auto;
            margin-right: auto; /* Horizontally centered */
            height: 350px; /* Default height */
            max-height: 400px; /* Max height constraint */
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }

        /* Custom Card Styling */
        .info-card {
            background-color: white;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 1.5rem;
            border-top: 4px solid #4F46E5; /* Indigo accent */
            transition: transform 0.2s;
        }
        .info-card:hover {
            transform: translateY(-2px);
        }

        /* Chat Widget Styling */
        .chat-widget {
            transition: all 0.3s ease-in-out;
        }
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }
        .chat-messages::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .chat-messages::-webkit-scrollbar-thumb {
            background: #c7c7c7;
            border-radius: 3px;
        }
        
        /* Markdown Content Styling within Chat */
        .prose p { margin-bottom: 0.5em; }
        .prose ul { list-style-type: disc; margin-left: 1.2em; margin-bottom: 0.5em; }
        .prose strong { color: #4F46E5; }
    </style>
</head>
<body class="antialiased pb-20">

    <!-- Navigation / Header -->
    <header class="bg-indigo-700 text-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold flex items-center gap-2">
                    <span data-i18n="headerTitle">æœŸæƒé›¶åŸºç¡€</span>
                    <span class="text-xs bg-pink-500 px-2 py-0.5 rounded-full" data-i18n="headerBadge">AI å¢å¼ºç‰ˆ</span>
                </h1>
                <p class="text-sm text-indigo-200" data-i18n="headerSubtitle">Episode 1: ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å­¦æœŸæƒï¼Ÿ</p>
            </div>
            <div class="flex items-center gap-4">
                <div class="hidden md:block text-sm font-semibold bg-indigo-800 px-3 py-1 rounded">
                    From Zero to Hero
                </div>
                <!-- Language Selector -->
                <select id="languageSelector" class="bg-indigo-600 text-white border border-indigo-400 rounded px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-pink-500">
                    <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                    <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                    <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                </select>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8 space-y-12">

        <!-- SECTION 1: THE HOOK -->
        <section id="intro" class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
            <div class="order-2 md:order-1">
                <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-pink-500">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4" data-i18n="introTitle">æ„Ÿæ©èŠ‚æŠ•æœºï¼šåƒå‡ºæ¥çš„æœºä¼šï¼Ÿ</h2>
                    <p class="text-gray-600 mb-4 leading-relaxed" data-i18n="introText">
                        æ•…äº‹ä»ä¸€ä¸ªç®€å•çš„é€»è¾‘å¼€å§‹ï¼šæ„Ÿæ©èŠ‚å¤§å®¶åƒå¤ªå¤š -> èŠ‚åæƒ³è¦å‡è‚¥ -> å¥èº«æˆ¿ç”Ÿæ„ç«çˆ†ã€‚
                        è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåå°”è¡—ç›¯ä¸Šäº† <strong>Planet Fitness (æ˜Ÿçƒå¥èº«)</strong>ã€‚ä½†ä¸å…¶ç›´æ¥ä¹°è‚¡ç¥¨ï¼Œä¸“å®¶æ¨èäº†ä¸€ä¸ªåå­—é•¿åˆ°è®©äººçª’æ¯çš„ç­–ç•¥...
                    </p>
                    <div class="bg-indigo-50 p-4 rounded-lg">
                        <p class="font-bold text-indigo-700 text-lg">"Bull Call Spread Risk Reversal"</p>
                        <p class="text-xs text-indigo-500 mt-1" data-i18n="introStrategyNote">ï¼ˆè¿™åˆ°åº•æ˜¯ä»€ä¹ˆç¼åˆæ€ªï¼Ÿï¼‰</p>
                    </div>
                </div>
            </div>
            <div class="order-1 md:order-2 flex flex-col items-center">
                <div class="chart-container">
                    <canvas id="caloriesChart"></canvas>
                </div>
                <p class="text-sm text-gray-500 mt-2 text-center" data-i18n="introChartCaption">3000å¤§å¡/é¡¿çš„æ™šé¤å¼•å‘çš„æŠ•èµ„è´è¶æ•ˆåº”</p>
            </div>
        </section>

        <!-- SECTION 2: BACK TO BASICS - CALL OPTION -->
        <section id="call-option" class="bg-white rounded-2xl shadow-lg p-8">
            <div class="mb-6 border-b pb-4">
                <h2 class="text-3xl font-bold text-indigo-700 flex items-center gap-2">
                    <span class="text-4xl">ğŸ </span> <span data-i18n="callTitle">Call (è®¤è´­æœŸæƒ)</span>
                </h2>
                <p class="text-gray-500 mt-2" data-i18n="callSubtitle">æ ¸å¿ƒé€»è¾‘ï¼šäº¤å®šé‡‘ï¼Œé”ä»·æ ¼ (Buy Low, Sell High)</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div>
                    <h3 class="text-xl font-bold text-gray-800 mb-3" data-i18n="callAnalogyTitle">ç±»æ¯”ï¼šä¹°æˆ¿å®šé‡‘</h3>
                    <p class="text-gray-600 mb-4 leading-relaxed" data-i18n="callAnalogyText">
                        æƒ³è±¡ä½ çœ‹ä¸­ä¸€å¥—100ä¸‡çš„æˆ¿å­ã€‚ä½ æ”¯ä»˜äº† <strong>1ä¸‡å…ƒå®šé‡‘ (æƒåˆ©é‡‘)</strong>ï¼Œé”å®šäº†ä¸‹ä¸ªæœˆç”¨100ä¸‡ä¹°æˆ¿çš„æƒåˆ©ã€‚
                    </p>
                    <ul class="space-y-2 mb-6 text-sm">
                        <li class="flex items-center gap-2">
                            <span class="text-green-500 font-bold">âœ”</span>
                            <span data-i18n="callScenarioWin"><strong>è‹¥æˆ¿ä»·æ¶¨åˆ°120ä¸‡ï¼š</strong> ä½ æŒ‰100ä¸‡ä¹°å…¥ï¼Œè½¬æ‰‹å–å‡ºèµš20ä¸‡ã€‚å›æŠ¥ç‡ 2000%ï¼</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <span class="text-red-500 font-bold">âœ˜</span>
                            <span data-i18n="callScenarioLose"><strong>è‹¥æˆ¿ä»·è·Œåˆ°80ä¸‡ï¼š</strong> ä½ æ”¾å¼ƒå®šé‡‘ï¼ŒåªæŸå¤±1ä¸‡ã€‚æˆ¿å­ä¸è¦äº†ã€‚</span>
                        </li>
                    </ul>
                    <div class="bg-blue-50 p-4 rounded border border-blue-200">
                        <h4 class="font-bold text-blue-800" data-i18n="callExampleTitle">è‚¡å¸‚å®ä¾‹ï¼šè‹±ä¼Ÿè¾¾ (NVDA)</h4>
                        <p class="text-sm text-blue-700 mt-1" data-i18n="callExampleText">
                            è‚¡ä»· $100ã€‚ä½ èŠ± $5 ä¹°å…¥ Call (è¡Œæƒä»· $100)ã€‚<br>
                            å¦‚æœæ¶¨åˆ° $150ï¼Œä½ èµš $45 ($150 - $100 - $5)ã€‚<br>
                            ç¿»äº†9å€ï¼è¿™å°±æ˜¯<strong>ä»¥å°åšå¤§</strong>ã€‚
                        </p>
                    </div>
                </div>
                <div class="flex flex-col justify-center">
                    <div class="chart-container">
                        <canvas id="callPayoffChart"></canvas>
                    </div>
                    <p class="text-xs text-gray-400 text-center mt-2" data-i18n="callChartCaption">Call Option æŸç›Šæ›²çº¿ï¼šé£é™©æœ‰é™ï¼Œæ”¶ç›Šæ— é™</p>
                </div>
            </div>
        </section>

        <!-- SECTION 3: BACK TO BASICS - PUT OPTION -->
        <section id="put-option" class="bg-white rounded-2xl shadow-lg p-8 border-t-4 border-pink-500">
            <div class="mb-6 border-b pb-4">
                <h2 class="text-3xl font-bold text-pink-600 flex items-center gap-2">
                    <span class="text-4xl">ğŸš—</span> <span data-i18n="putTitle">Put (è®¤æ²½æœŸæƒ)</span>
                </h2>
                <p class="text-gray-500 mt-2" data-i18n="putSubtitle">æ ¸å¿ƒé€»è¾‘ï¼šä¹°ä¿é™©ï¼Œé˜²ç¾å®³ (Hedging / Protection)</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                <div class="order-2 md:order-1 chart-container">
                    <canvas id="putProtectionChart"></canvas>
                </div>
                <div class="order-1 md:order-2">
                    <h3 class="text-xl font-bold text-gray-800 mb-3" data-i18n="putAnalogyTitle">ç±»æ¯”ï¼šè½¦é™©</h3>
                    <p class="text-gray-600 mb-4 leading-relaxed" data-i18n="putAnalogyText">
                        ä½ ä¹°äº†è‚¡ç¥¨æ€•è·Œï¼Ÿé‚£å°±ä¹° Putã€‚å°±åƒç»™è½¦ä¹°ä¿é™©ã€‚
                        å¦‚æœè‚¡ä»·å´©ç›˜ï¼ˆæ’è½¦ï¼‰ï¼Œä¿é™©å…¬å¸ï¼ˆå–Putçš„äººï¼‰å¿…é¡»æŒ‰<strong>åŸä»·</strong>æ¥ç›˜ä½ çš„è‚¡ç¥¨ã€‚
                    </p>
                    <div class="bg-pink-50 p-4 rounded border border-pink-200">
                        <p class="text-sm text-pink-800" data-i18n="putActionText">
                            <strong>Buy Put:</strong> ä»˜å‡ºä¸€ç¬”å°é’±ï¼Œè·å¾—â€œæ— è®ºè·Œå¤šå°‘éƒ½èƒ½æŒ‰åŸä»·å–å‡ºâ€çš„æƒåˆ©ã€‚<br>
                            <strong>åœºæ™¯:</strong> è´¢æŠ¥å‘å¸ƒå‰ï¼Œæ‹…å¿ƒæš´é›·ã€‚
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 4: THE BUFFETT MINDSET - SELLING PUTS -->
        <section id="sell-put" class="bg-gray-800 text-white rounded-2xl shadow-xl p-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                <div>
                    <h2 class="text-3xl font-bold text-cyan-400 mb-4" data-i18n="sellPutTitle">ä¸ºä»€ä¹ˆè¦åšâ€œä¿é™©å…¬å¸â€ (Sell Put)?</h2>
                    <p class="text-gray-300 mb-6 text-lg leading-relaxed" data-i18n="sellPutIntro">
                        åˆå­¦è€…ä¹°ä¿é™©ï¼Œ<strong>é«˜æ‰‹å–ä¿é™©</strong>ã€‚
                        å¦‚æœä½ æƒ³åƒå·´è²ç‰¹ä¸€æ ·æ€è€ƒï¼Œä½ ä¸ä¼šå•çº¯èµŒè‚¡ç¥¨ä¸è·Œï¼Œè€Œæ˜¯ï¼š
                    </p>
                    <div class="bg-gray-700 p-6 rounded-lg mb-6 border-l-4 border-cyan-400">
                        <p class="italic text-lg" data-i18n="sellPutQuote">
                            "æˆ‘æƒ³ä¹°è¿™åªè‚¡ç¥¨ï¼Œä½†ç°åœ¨çš„ä»·æ ¼å¤ªè´µã€‚å¦‚æœè·Œåˆ° $90ï¼Œæˆ‘æ„¿æ„å…¨ä»“æ¥ç›˜ã€‚"
                        </p>
                    </div>
                    <p class="text-gray-300" data-i18n="sellPutLogic">
                        ä½ å–å‡º $90 çš„ Putï¼Œæ”¶å–æƒåˆ©é‡‘ã€‚
                        <br>1. <strong>æ²¡è·Œåˆ° $90:</strong> ç™½èµšæƒåˆ©é‡‘ (æ”¶ç§Ÿ)ã€‚
                        <br>2. <strong>è·Œåˆ° $90:</strong> æŒ‰ $90 ä¹°å…¥è‚¡ç¥¨ (æœ¬æ¥å°±æƒ³ä¹°çš„ä»·æ ¼) - æƒåˆ©é‡‘è¡¥è´´ã€‚
                    </p>
                </div>
                <div>
                    <h3 class="text-xl font-bold text-gray-200 mb-4 text-center" data-i18n="sellPutChartTitle">å®é™…æŒä»“æˆæœ¬å¯¹æ¯”</h3>
                    <div class="chart-container">
                        <canvas id="sellPutChart"></canvas>
                    </div>
                    <p class="text-xs text-gray-400 text-center mt-2" data-i18n="sellPutChartCaption">Sell Put = å¸¦è¡¥è´´çš„é™ä»·ä¹°å•</p>
                </div>
            </div>
        </section>

        <!-- SECTION 5: THE SOLUTION - RISK REVERSAL -->
        <section id="risk-reversal" class="bg-gradient-to-br from-indigo-50 to-white rounded-2xl shadow-lg p-8 relative">
            <div class="text-center max-w-3xl mx-auto mb-10">
                <h2 class="text-3xl font-bold text-indigo-800 mb-4" data-i18n="rrTitle">ç»ˆæç­–ç•¥: Risk Reversal (é£é™©é€†è½¬)</h2>
                <p class="text-gray-600 text-lg" data-i18n="rrSubtitle">
                    ä¸ç”¨æé’±çš„â€œç©ºæ‰‹å¥—ç™½ç‹¼â€ï¼Ÿ<br>
                    <strong>é€»è¾‘ï¼š</strong> ç”¨â€œæ„¿æ„æ¥ç›˜çš„ä¹‰åŠ¡â€ (Sell Put) èµšæ¥çš„é’±ï¼Œå»ä¹°â€œä¸Šæ¶¨çš„å®šé‡‘â€ (Buy Call)ã€‚
                </p>
            </div>

            <!-- Flow Diagram -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-10 items-stretch">
                <!-- Step 1 -->
                <div class="bg-white p-4 rounded-lg shadow border-2 border-pink-200 flex flex-col items-center text-center">
                    <div class="text-2xl mb-2">ğŸ¤</div>
                    <h4 class="font-bold text-pink-600">Sell Put</h4>
                    <p class="text-xs text-gray-500 mt-2" data-i18n="rrStep1">
                        å–å‡ºé˜²è·Œä¿é™©<br>
                        "è·Œç ´97.5æˆ‘æ¥ç›˜"
                    </p>
                    <div class="mt-auto pt-4 font-bold text-green-600" data-i18n="rrStep1Profit">+ æ”¶å–æƒåˆ©é‡‘</div>
                </div>
                
                <!-- Arrow -->
                <div class="hidden md:flex items-center justify-center">
                    <div class="text-4xl text-gray-300">â¡ï¸</div>
                </div>
                <div class="md:hidden flex items-center justify-center py-2">
                    <div class="text-2xl text-gray-300">â¬‡ï¸</div>
                </div>

                <!-- Step 2 -->
                <div class="bg-white p-4 rounded-lg shadow border-2 border-indigo-200 flex flex-col items-center text-center">
                    <div class="text-2xl mb-2">ğŸš€</div>
                    <h4 class="font-bold text-indigo-600">Buy Call</h4>
                    <p class="text-xs text-gray-500 mt-2" data-i18n="rrStep2">
                        ä¹°å…¥çœ‹æ¶¨æƒåˆ©<br>
                        "æ¶¨è¿‡115æˆ‘èµšé’±"
                    </p>
                    <div class="mt-auto pt-4 font-bold text-red-500" data-i18n="rrStep2Cost">- æ”¯ä»˜æƒåˆ©é‡‘</div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2">
                     <div class="chart-container">
                        <canvas id="riskReversalChart"></canvas>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-inner">
                    <h3 class="font-bold text-gray-800 mb-4" data-i18n="rrSummaryTitle">ç­–ç•¥æ€»ç»“</h3>
                    <ul class="space-y-4 text-sm text-gray-600">
                        <li class="flex items-start">
                            <span class="mr-2 mt-1 text-green-500">ğŸŸ¢</span>
                            <span data-i18n="rrSummaryWin"><strong>å¤§æ¶¨:</strong> ä¹Ÿå°±æ˜¯è‚¡ä»· > 115ï¼Œä½ æ‹¥æœ‰ Callï¼Œæ”¶ç›Šæ— é™ã€‚</span>
                        </li>
                         <li class="flex items-start">
                            <span class="mr-2 mt-1 text-yellow-500">ğŸŸ¡</span>
                            <span data-i18n="rrSummaryDraw"><strong>éœ‡è¡:</strong> åœ¨ 97.5 å’Œ 115 ä¹‹é—´ï¼Œä¸äºä¸èµšï¼ˆå› ä¸ºæƒåˆ©é‡‘ç›¸äº’æŠµæ¶ˆäº†ï¼‰ã€‚è‡ªå¸¦â€œå®‰å…¨ç¼“å†²åŒºâ€ã€‚</span>
                        </li>
                        <li class="flex items-start">
                            <span class="mr-2 mt-1 text-red-500">ğŸ”´</span>
                            <span data-i18n="rrSummaryLose"><strong>å¤§è·Œ:</strong> è·Œç ´ 97.5ï¼Œä½ éœ€è¦æŒ‰ 97.5 ä¹°å…¥è‚¡ç¥¨ã€‚ä½†è¿™æœ¬æ¥å°±æ˜¯ä½ å¿ƒä»ªçš„â€œæŠ„åº•ä»·â€ã€‚</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- GEMINI API FEATURE: QUIZ GENERATOR -->
            <div class="mt-12 bg-indigo-900 rounded-xl p-8 text-white relative overflow-hidden">
                <div class="relative z-10 text-center">
                    <h3 class="text-2xl font-bold mb-2" data-i18n="quizTitle">âœ¨ Gemini AI æŒ‘æˆ˜</h3>
                    <p class="text-indigo-200 mb-6" data-i18n="quizSubtitle">ä¸ç¡®å®šè‡ªå·±æ˜¯å¦æŒæ¡äº† Risk Reversalï¼Ÿè®© AI è€ƒè€ƒä½ ã€‚</p>
                    
                    <button id="generateQuizBtn" class="bg-gradient-to-r from-pink-500 to-indigo-500 hover:from-pink-600 hover:to-indigo-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transform transition hover:scale-105 flex items-center gap-2 mx-auto">
                        <span class="text-xl">âœ¨</span> <span data-i18n="quizBtn">ç”Ÿæˆä»Šæ—¥æŒ‘æˆ˜é¢˜</span>
                    </button>

                    <div id="quizContainer" class="hidden mt-8 bg-white/10 backdrop-blur-sm rounded-lg p-6 text-left max-w-2xl mx-auto border border-white/20">
                        <div class="animate-pulse flex space-x-4">
                            <div class="flex-1 space-y-4 py-1">
                                <div class="h-4 bg-white/20 rounded w-3/4"></div>
                                <div class="space-y-2">
                                    <div class="h-4 bg-white/20 rounded"></div>
                                    <div class="h-4 bg-white/20 rounded w-5/6"></div>
                                </div>
                            </div>
                        </div>
                        <p class="text-center text-sm text-indigo-300 mt-4" data-i18n="quizLoading">æ­£åœ¨æ€è€ƒé¢˜ç›®...</p>
                    </div>
                </div>
                <!-- Decorative background elements -->
                <div class="absolute top-0 right-0 -mr-16 -mt-16 w-64 h-64 rounded-full bg-pink-500 opacity-20 filter blur-3xl"></div>
                <div class="absolute bottom-0 left-0 -ml-16 -mb-16 w-64 h-64 rounded-full bg-indigo-500 opacity-20 filter blur-3xl"></div>
            </div>

        </section>

    </main>

    <footer class="bg-gray-800 text-gray-400 py-8 mt-12 pb-24 md:pb-8">
        <div class="container mx-auto px-4 text-center">
            <p class="mb-2">Generated by Gemini Canvas Infographics</p>
            <p class="text-xs">
                Data sources: Script based on "Thanksgiving Options Strategy". <br>
                Disclaimer: Financial visuals are for educational purposes only. Not investment advice.
            </p>
            <p class="text-xs mt-4 text-gray-600">NO SVG USED. NO MERMAID JS USED.</p>
        </div>
    </footer>

    <!-- GEMINI API FEATURE: FLOATING CHAT -->
    <div id="geminiChatWidget" class="fixed bottom-6 right-6 z-50 flex flex-col items-end">
        <!-- Chat Window (Hidden by default) -->
        <div id="chatWindow" class="hidden bg-white w-80 md:w-96 rounded-2xl shadow-2xl mb-4 flex flex-col border border-gray-200 overflow-hidden transform transition-all duration-300 origin-bottom-right">
            <div class="bg-gradient-to-r from-indigo-600 to-indigo-800 p-4 flex justify-between items-center text-white">
                <div class="flex items-center gap-2">
                    <div class="bg-white/20 p-1 rounded-full">âœ¨</div>
                    <span class="font-bold" data-i18n="chatTitle">Gemini åŠ©æ•™</span>
                </div>
                <button id="closeChatBtn" class="hover:bg-white/10 rounded p-1">âœ•</button>
            </div>
            <div id="chatMessages" class="chat-messages h-80 overflow-y-auto p-4 space-y-4 bg-gray-50 text-sm">
                <div class="flex gap-2">
                    <div class="bg-indigo-100 text-indigo-800 p-3 rounded-lg rounded-tl-none max-w-[85%]" data-i18n="chatWelcome">
                        ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„ AI æœŸæƒåŠ©æ•™ã€‚å…³äºä»Šå¤©çš„ Call, Put æˆ–è€… Risk Reversal ç­–ç•¥ï¼Œæœ‰ä»€ä¹ˆä¸æ‡‚çš„éƒ½å¯ä»¥é—®æˆ‘ï¼
                    </div>
                </div>
            </div>
            <div class="p-3 bg-white border-t border-gray-100">
                <form id="chatForm" class="flex gap-2">
                    <input type="text" id="userQuery" placeholder="è¾“å…¥ä½ çš„é—®é¢˜..." class="flex-1 border border-gray-300 rounded-full px-4 py-2 text-sm focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500" data-i18n-placeholder="chatPlaceholder">
                    <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white rounded-full p-2 w-10 h-10 flex items-center justify-center shadow-md transition-colors">
                        â¤
                    </button>
                </form>
            </div>
        </div>

        <!-- Floating Action Button -->
        <button id="toggleChatBtn" class="bg-gradient-to-r from-indigo-600 to-pink-500 hover:from-indigo-700 hover:to-pink-600 text-white rounded-full p-4 shadow-xl transform transition hover:scale-110 flex items-center gap-2 group">
            <span class="text-2xl">âœ¨</span>
            <span class="font-bold hidden group-hover:inline max-w-0 group-hover:max-w-xs transition-all duration-500 overflow-hidden whitespace-nowrap" data-i18n="askAiBtn">æé—® AI åŠ©æ•™</span>
        </button>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- TRANSLATION DATA ---
        const translations = {
            zh: {
                headerTitle: "æœŸæƒé›¶åŸºç¡€",
                headerBadge: "AI å¢å¼ºç‰ˆ",
                headerSubtitle: "Episode 1: ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å­¦æœŸæƒï¼Ÿ",
                introTitle: "æ„Ÿæ©èŠ‚æŠ•æœºï¼šåƒå‡ºæ¥çš„æœºä¼šï¼Ÿ",
                introText: "æ•…äº‹ä»ä¸€ä¸ªç®€å•çš„é€»è¾‘å¼€å§‹ï¼šæ„Ÿæ©èŠ‚å¤§å®¶åƒå¤ªå¤š -> èŠ‚åæƒ³è¦å‡è‚¥ -> å¥èº«æˆ¿ç”Ÿæ„ç«çˆ†ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåå°”è¡—ç›¯ä¸Šäº† Planet Fitness (æ˜Ÿçƒå¥èº«)ã€‚ä½†ä¸å…¶ç›´æ¥ä¹°è‚¡ç¥¨ï¼Œä¸“å®¶æ¨èäº†ä¸€ä¸ªåå­—é•¿åˆ°è®©äººçª’æ¯çš„ç­–ç•¥...",
                introStrategyNote: "ï¼ˆè¿™åˆ°åº•æ˜¯ä»€ä¹ˆç¼åˆæ€ªï¼Ÿï¼‰",
                introChartCaption: "3000å¤§å¡/é¡¿çš„æ™šé¤å¼•å‘çš„æŠ•èµ„è´è¶æ•ˆåº”",
                callTitle: "Call (è®¤è´­æœŸæƒ)",
                callSubtitle: "æ ¸å¿ƒé€»è¾‘ï¼šäº¤å®šé‡‘ï¼Œé”ä»·æ ¼ (Buy Low, Sell High)",
                callAnalogyTitle: "ç±»æ¯”ï¼šä¹°æˆ¿å®šé‡‘",
                callAnalogyText: "æƒ³è±¡ä½ çœ‹ä¸­ä¸€å¥—100ä¸‡çš„æˆ¿å­ã€‚ä½ æ”¯ä»˜äº† 1ä¸‡å…ƒå®šé‡‘ (æƒåˆ©é‡‘)ï¼Œé”å®šäº†ä¸‹ä¸ªæœˆç”¨100ä¸‡ä¹°æˆ¿çš„æƒåˆ©ã€‚",
                callScenarioWin: "<strong>è‹¥æˆ¿ä»·æ¶¨åˆ°120ä¸‡ï¼š</strong> ä½ æŒ‰100ä¸‡ä¹°å…¥ï¼Œè½¬æ‰‹å–å‡ºèµš20ä¸‡ã€‚å›æŠ¥ç‡ 2000%ï¼",
                callScenarioLose: "<strong>è‹¥æˆ¿ä»·è·Œåˆ°80ä¸‡ï¼š</strong> ä½ æ”¾å¼ƒå®šé‡‘ï¼ŒåªæŸå¤±1ä¸‡ã€‚æˆ¿å­ä¸è¦äº†ã€‚",
                callExampleTitle: "è‚¡å¸‚å®ä¾‹ï¼šè‹±ä¼Ÿè¾¾ (NVDA)",
                callExampleText: "è‚¡ä»· $100ã€‚ä½ èŠ± $5 ä¹°å…¥ Call (è¡Œæƒä»· $100)ã€‚<br>å¦‚æœæ¶¨åˆ° $150ï¼Œä½ èµš $45 ($150 - $100 - $5)ã€‚<br>ç¿»äº†9å€ï¼è¿™å°±æ˜¯<strong>ä»¥å°åšå¤§</strong>ã€‚",
                callChartCaption: "Call Option æŸç›Šæ›²çº¿ï¼šé£é™©æœ‰é™ï¼Œæ”¶ç›Šæ— é™",
                putTitle: "Put (è®¤æ²½æœŸæƒ)",
                putSubtitle: "æ ¸å¿ƒé€»è¾‘ï¼šä¹°ä¿é™©ï¼Œé˜²ç¾å®³ (Hedging / Protection)",
                putAnalogyTitle: "ç±»æ¯”ï¼šè½¦é™©",
                putAnalogyText: "ä½ ä¹°äº†è‚¡ç¥¨æ€•è·Œï¼Ÿé‚£å°±ä¹° Putã€‚å°±åƒç»™è½¦ä¹°ä¿é™©ã€‚å¦‚æœè‚¡ä»·å´©ç›˜ï¼ˆæ’è½¦ï¼‰ï¼Œä¿é™©å…¬å¸ï¼ˆå–Putçš„äººï¼‰å¿…é¡»æŒ‰<strong>åŸä»·</strong>æ¥ç›˜ä½ çš„è‚¡ç¥¨ã€‚",
                putActionText: "<strong>Buy Put:</strong> ä»˜å‡ºä¸€ç¬”å°é’±ï¼Œè·å¾—â€œæ— è®ºè·Œå¤šå°‘éƒ½èƒ½æŒ‰åŸä»·å–å‡ºâ€çš„æƒåˆ©ã€‚<br><strong>åœºæ™¯:</strong> è´¢æŠ¥å‘å¸ƒå‰ï¼Œæ‹…å¿ƒæš´é›·ã€‚",
                sellPutTitle: "ä¸ºä»€ä¹ˆè¦åšâ€œä¿é™©å…¬å¸â€ (Sell Put)?",
                sellPutIntro: "åˆå­¦è€…ä¹°ä¿é™©ï¼Œ<strong>é«˜æ‰‹å–ä¿é™©</strong>ã€‚å¦‚æœä½ æƒ³åƒå·´è²ç‰¹ä¸€æ ·æ€è€ƒï¼Œä½ ä¸ä¼šå•çº¯èµŒè‚¡ç¥¨ä¸è·Œï¼Œè€Œæ˜¯ï¼š",
                sellPutQuote: "\"æˆ‘æƒ³ä¹°è¿™åªè‚¡ç¥¨ï¼Œä½†ç°åœ¨çš„ä»·æ ¼å¤ªè´µã€‚å¦‚æœè·Œåˆ° $90ï¼Œæˆ‘æ„¿æ„å…¨ä»“æ¥ç›˜ã€‚\"",
                sellPutLogic: "ä½ å–å‡º $90 çš„ Putï¼Œæ”¶å–æƒåˆ©é‡‘ã€‚<br>1. <strong>æ²¡è·Œåˆ° $90:</strong> ç™½èµšæƒåˆ©é‡‘ (æ”¶ç§Ÿ)ã€‚<br>2. <strong>è·Œåˆ° $90:</strong> æŒ‰ $90 ä¹°å…¥è‚¡ç¥¨ (æœ¬æ¥å°±æƒ³ä¹°çš„ä»·æ ¼) - æƒåˆ©é‡‘è¡¥è´´ã€‚",
                sellPutChartTitle: "å®é™…æŒä»“æˆæœ¬å¯¹æ¯”",
                sellPutChartCaption: "Sell Put = å¸¦è¡¥è´´çš„é™ä»·ä¹°å•",
                rrTitle: "ç»ˆæç­–ç•¥: Risk Reversal (é£é™©é€†è½¬)",
                rrSubtitle: "ä¸ç”¨æé’±çš„â€œç©ºæ‰‹å¥—ç™½ç‹¼â€ï¼Ÿ<br><strong>é€»è¾‘ï¼š</strong> ç”¨â€œæ„¿æ„æ¥ç›˜çš„ä¹‰åŠ¡â€ (Sell Put) èµšæ¥çš„é’±ï¼Œå»ä¹°â€œä¸Šæ¶¨çš„å®šé‡‘â€ (Buy Call)ã€‚",
                rrStep1: "å–å‡ºé˜²è·Œä¿é™©<br>\"è·Œç ´97.5æˆ‘æ¥ç›˜\"",
                rrStep1Profit: "+ æ”¶å–æƒåˆ©é‡‘",
                rrStep2: "ä¹°å…¥çœ‹æ¶¨æƒåˆ©<br>\"æ¶¨è¿‡115æˆ‘èµšé’±\"",
                rrStep2Cost: "- æ”¯ä»˜æƒåˆ©é‡‘",
                rrSummaryTitle: "ç­–ç•¥æ€»ç»“",
                rrSummaryWin: "<strong>å¤§æ¶¨:</strong> ä¹Ÿå°±æ˜¯è‚¡ä»· > 115ï¼Œä½ æ‹¥æœ‰ Callï¼Œæ”¶ç›Šæ— é™ã€‚",
                rrSummaryDraw: "<strong>éœ‡è¡:</strong> åœ¨ 97.5 å’Œ 115 ä¹‹é—´ï¼Œä¸äºä¸èµšï¼ˆå› ä¸ºæƒåˆ©é‡‘ç›¸äº’æŠµæ¶ˆäº†ï¼‰ã€‚è‡ªå¸¦â€œå®‰å…¨ç¼“å†²åŒºâ€ã€‚",
                rrSummaryLose: "<strong>å¤§è·Œ:</strong> è·Œç ´ 97.5ï¼Œä½ éœ€è¦æŒ‰ 97.5 ä¹°å…¥è‚¡ç¥¨ã€‚ä½†è¿™æœ¬æ¥å°±æ˜¯ä½ å¿ƒä»ªçš„â€œæŠ„åº•ä»·â€ã€‚",
                quizTitle: "âœ¨ Gemini AI æŒ‘æˆ˜",
                quizSubtitle: "ä¸ç¡®å®šè‡ªå·±æ˜¯å¦æŒæ¡äº† Risk Reversalï¼Ÿè®© AI è€ƒè€ƒä½ ã€‚",
                quizBtn: "ç”Ÿæˆä»Šæ—¥æŒ‘æˆ˜é¢˜",
                quizLoading: "æ­£åœ¨æ€è€ƒé¢˜ç›®...",
                chatTitle: "Gemini åŠ©æ•™",
                chatWelcome: "ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„ AI æœŸæƒåŠ©æ•™ã€‚å…³äºä»Šå¤©çš„ Call, Put æˆ–è€… Risk Reversal ç­–ç•¥ï¼Œæœ‰ä»€ä¹ˆä¸æ‡‚çš„éƒ½å¯ä»¥é—®æˆ‘ï¼",
                chatPlaceholder: "è¾“å…¥ä½ çš„é—®é¢˜...",
                askAiBtn: "æé—® AI åŠ©æ•™",
                // Charts Data
                chartCaloriesLabel: "å¡è·¯é‡Œæ‘„å…¥ (kcal)",
                chartCaloriesTitle: "æš´é¥®æš´é£Ÿé©±åŠ¨çš„å¥èº«éœ€æ±‚",
                chartCallLabel: "ç›ˆäºé‡‘é¢ ($)",
                chartCallTitle: "Call Payoff: è‚¡ä»·æ¶¨å¾—è¶Šé«˜èµšå¾—è¶Šå¤š",
                chartPutLabels: ["è£¸å¥”æŒæœ‰ (æ— ä¿æŠ¤)", "æŒæœ‰ Put ä¿æŠ¤"],
                chartPutLabel: "è‚¡ä»·è…°æ–©æ—¶çš„äºæŸ ($)",
                chartPutTitle: "å½“è‚¡ä»·ä» $100 è·Œåˆ° $50",
                chartSellPutLabels: ["ç›´æ¥ä¹°å…¥ç°ä»·è‚¡ç¥¨", "å–å‡º Put æ¥ç›˜"],
                chartSellPutLabel: "å®é™…æŒä»“æˆæœ¬ ($)",
                chartSellPutTitle: "å·´è²ç‰¹å¦‚ä½•ç”¨\"æŠ˜æ‰£ä»·\"ä¹°è‚¡",
                chartRRLabel: "Risk Reversal æŸç›Š",
                chartRRTitle: "ç­–ç•¥è¡¨ç°ï¼šä¸‹æœ‰æ¥ç›˜ï¼Œä¸Šæœ‰æš´åˆ©ï¼Œä¸­é—´èººå¹³"
            },
            en: {
                headerTitle: "Options from Zero",
                headerBadge: "AI Enhanced",
                headerSubtitle: "Episode 1: Why learn Options?",
                introTitle: "Thanksgiving Speculation",
                introText: "Simple logic: Thanksgiving Overeating -> Post-holiday Weight Loss -> Gym Boom. That's why Wall Street is eyeing <strong>Planet Fitness</strong>. But experts recommend a strategy with a terrifyingly long name...",
                introStrategyNote: "(What is this Frankenstein strategy?)",
                introChartCaption: "Investment butterfly effect from a 3000 kcal dinner",
                callTitle: "Call Option",
                callSubtitle: "Logic: Down payment to lock price (Buy Low, Sell High)",
                callAnalogyTitle: "Analogy: House Deposit",
                callAnalogyText: "You see a $1M house. You pay <strong>$10k deposit (Premium)</strong> to lock the right to buy at $1M next month.",
                callScenarioWin: "<strong>Price hits $1.2M:</strong> Buy at $1M, sell at $1.2M. Profit $200k (2000% return)!",
                callScenarioLose: "<strong>Price drops to $800k:</strong> Walk away. Lose only deposit ($10k).",
                callExampleTitle: "Stock Example: NVIDIA (NVDA)",
                callExampleText: "Stock $100. Buy Call (Strike $100) for $5.<br>If it hits $150, you earn $45 ($150 - $100 - $5).<br>9x Return! This is <strong>Leverage</strong>.",
                callChartCaption: "Call Payoff: Limited Risk, Unlimited Upside",
                putTitle: "Put Option",
                putSubtitle: "Logic: Insurance against disaster (Hedging)",
                putAnalogyTitle: "Analogy: Car Insurance",
                putAnalogyText: "Afraid your stock will crash? Buy a Put. Like car insurance. If it crashes, the insurer (Put Seller) MUST buy your stock at the <strong>Original Price</strong>.",
                putActionText: "<strong>Buy Put:</strong> Pay small premium for right to sell at original price.<br><strong>Scenario:</strong> Earnings report protection.",
                sellPutTitle: "Why be the \"Insurer\" (Sell Put)?",
                sellPutIntro: "Beginners buy insurance, <strong>Pros sell insurance</strong>. Like Buffett, you don't just gamble, you say:",
                sellPutQuote: "\"I want to buy this stock, but it's too expensive. If it drops to $90, I'll buy it all.\"",
                sellPutLogic: "Sell $90 Put, collect premium.<br>1. <strong>Above $90:</strong> Keep premium (Free money).<br>2. <strong>Drops to $90:</strong> Buy at $90 (Target Price) - Premium subsidy.",
                sellPutChartTitle: "Cost Basis Comparison",
                sellPutChartCaption: "Sell Put = Limit Order with Subsidy",
                rrTitle: "Ultimate Strategy: Risk Reversal",
                rrSubtitle: "Zero-Cost Entry?<br><strong>Logic:</strong> Use money from \"Obligation to Buy\" (Sell Put) to fund \"Right to Buy\" (Buy Call).",
                rrStep1: "Sell Downside Insurance<br>\"I'll buy if < 97.5\"",
                rrStep1Profit: "+ Collect Premium",
                rrStep2: "Buy Upside Potential<br>\"I profit if > 115\"",
                rrStep2Cost: "- Pay Premium",
                rrSummaryTitle: "Strategy Summary",
                rrSummaryWin: "<strong>Rally:</strong> Price > 115. You own the Call. Unlimited profit.",
                rrSummaryDraw: "<strong>Chop:</strong> Between 97.5 & 115. Breakeven (Premiums cancel out). Built-in buffer.",
                rrSummaryLose: "<strong>Crash:</strong> Price < 97.5. You buy stock at 97.5. But that was your target dip-buy price anyway.",
                quizTitle: "âœ¨ Gemini AI Challenge",
                quizSubtitle: "Mastered Risk Reversal? Let AI test you.",
                quizBtn: "Generate Quiz",
                quizLoading: "Generating question...",
                chatTitle: "Gemini Tutor",
                chatWelcome: "Hello! I'm your AI Options Tutor. Ask me anything about Calls, Puts, or Risk Reversal!",
                chatPlaceholder: "Ask a question...",
                askAiBtn: "Ask AI Tutor",
                // Charts Data
                chartCaloriesLabel: "Calories (kcal)",
                chartCaloriesTitle: "Overeating driving Gym Demand",
                chartCallLabel: "Profit/Loss ($)",
                chartCallTitle: "Call Payoff: The higher it goes, the more you make",
                chartPutLabels: ["Unprotected", "With Put Protection"],
                chartPutLabel: "Loss on 50% Crash ($)",
                chartPutTitle: "When stock drops $100 -> $50",
                chartSellPutLabels: ["Buy Stock Now", "Sell Put Entry"],
                chartSellPutLabel: "Cost Basis ($)",
                chartSellPutTitle: "Buffett's Discount Entry",
                chartRRLabel: "Risk Reversal P/L",
                chartRRTitle: "Performance: Downside Buy, Upside Profit, Flat Middle"
            },
            ja: {
                headerTitle: "ã‚¼ãƒ­ã‹ã‚‰å§‹ã‚ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³",
                headerBadge: "AIæ­è¼‰",
                headerSubtitle: "ç¬¬1è©±ï¼šãªãœã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å­¦ã¶ã®ã‹ï¼Ÿ",
                introTitle: "æ„Ÿè¬ç¥­ã®æŠ•æ©Ÿï¼šé£Ÿã¹éããŒãƒãƒ£ãƒ³ã‚¹ï¼Ÿ",
                introText: "å˜ç´”ãªãƒ­ã‚¸ãƒƒã‚¯ã§ã™ã€‚æ„Ÿè¬ç¥­ã§é£Ÿã¹éãã‚‹ -> æ¸›é‡ã—ãŸããªã‚‹ -> ã‚¸ãƒ ãŒå„²ã‹ã‚‹ã€‚ã ã‹ã‚‰ã‚¦ã‚©ãƒ¼ãƒ«è¡—ã¯ <strong>Planet Fitness</strong> ã«æ³¨ç›®ã—ã¦ã„ã¾ã™ã€‚ã—ã‹ã—å°‚é–€å®¶ã¯æã‚ã—ãé•·ã„åå‰ã®æˆ¦ç•¥ã‚’æ¨å¥¨ã—ã¦ã„ã¾ã™...",
                introStrategyNote: "ï¼ˆãƒ•ãƒ©ãƒ³ã‚±ãƒ³ã‚·ãƒ¥ã‚¿ã‚¤ãƒ³ã®ã‚ˆã†ãªæˆ¦ç•¥ï¼Ÿï¼‰",
                introChartCaption: "3000kcalã®å¤•é£ŸãŒå¼•ãèµ·ã“ã™æŠ•è³‡ã®ãƒã‚¿ãƒ•ãƒ©ã‚¤åŠ¹æœ",
                callTitle: "Call (ã‚³ãƒ¼ãƒ«ã‚ªãƒ—ã‚·ãƒ§ãƒ³)",
                callSubtitle: "ãƒ­ã‚¸ãƒƒã‚¯ï¼šæ‰‹ä»˜é‡‘ã§ä¾¡æ ¼ã‚’ãƒ­ãƒƒã‚¯ (å®‰ãè²·ã£ã¦é«˜ãå£²ã‚‹)",
                callAnalogyTitle: "ä¾‹ãˆï¼šå®¶ã®æ‰‹ä»˜é‡‘",
                callAnalogyText: "1å„„å††ã®å®¶ã‚’è¦‹ã¤ã‘ãŸã¨ã—ã¾ã™ã€‚<strong>100ä¸‡å††ã®æ‰‹ä»˜é‡‘ï¼ˆãƒ—ãƒ¬ãƒŸã‚¢ãƒ ï¼‰</strong>ã‚’æ‰•ã„ã€æ¥æœˆ1å„„å††ã§è²·ã†æ¨©åˆ©ã‚’ç¢ºä¿ã—ã¾ã™ã€‚",
                callScenarioWin: "<strong>1.2å„„å††ã«é«˜é¨°ï¼š</strong> 1å„„ã§è²·ã„ã€1.2å„„ã§å£²ã‚‹ã€‚2000ä¸‡å††ã®åˆ©ç›Š (20å€)ï¼",
                callScenarioLose: "<strong>8000ä¸‡å††ã«æš´è½ï¼š</strong> æ¨©åˆ©æ”¾æ£„ã€‚æå¤±ã¯æ‰‹ä»˜é‡‘ã®100ä¸‡å††ã®ã¿ã€‚",
                callExampleTitle: "æ ªå¼ã®ä¾‹ï¼šNVIDIA (NVDA)",
                callExampleText: "æ ªä¾¡ $100ã€‚$5ã§Call (è¡Œä½¿ä¾¡æ ¼ $100) ã‚’è³¼å…¥ã€‚<br>$150ã«ãªã‚Œã°ã€$45ã®åˆ©ç›Š ($150 - $100 - $5)ã€‚<br>9å€ã®ãƒªã‚¿ãƒ¼ãƒ³ï¼ã“ã‚ŒãŒ<strong>ãƒ¬ãƒãƒ¬ãƒƒã‚¸</strong>ã§ã™ã€‚",
                callChartCaption: "Callã®æç›Šï¼šãƒªã‚¹ã‚¯é™å®šã€åˆ©ç›Šç„¡é™å¤§",
                putTitle: "Put (ãƒ—ãƒƒãƒˆã‚ªãƒ—ã‚·ãƒ§ãƒ³)",
                putSubtitle: "ãƒ­ã‚¸ãƒƒã‚¯ï¼šç½å®³ä¿é™º (ãƒ˜ãƒƒã‚¸)",
                putAnalogyTitle: "ä¾‹ãˆï¼šè‡ªå‹•è»Šä¿é™º",
                putAnalogyText: "æ ªä¾¡æš´è½ãŒæ€–ã„ï¼Ÿãªã‚‰Putã‚’è²·ã„ã¾ã—ã‚‡ã†ã€‚ä¿é™ºã®ã‚ˆã†ãªã‚‚ã®ã§ã™ã€‚æš´è½ã—ã¦ã‚‚ã€ä¿é™ºä¼šç¤¾ï¼ˆPutã®å£²ã‚Šæ‰‹ï¼‰ã¯<strong>å…ƒã®ä¾¡æ ¼</strong>ã§ã‚ãªãŸã®æ ªã‚’è²·ã„å–ã‚‰ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚",
                putActionText: "<strong>Buy Put:</strong> å°‘é¡ã§ã€Œå…ƒã®ä¾¡æ ¼ã§å£²ã‚‹æ¨©åˆ©ã€ã‚’è²·ã†ã€‚<br><strong>å ´é¢:</strong> æ±ºç®—ç™ºè¡¨å‰ã®æš´è½å¯¾ç­–ã€‚",
                sellPutTitle: "ãªãœã€Œä¿é™ºä¼šç¤¾ã€ã«ãªã‚‹ã®ã‹ (Sell Put)?",
                sellPutIntro: "åˆå¿ƒè€…ã¯ä¿é™ºã‚’è²·ã„ã€<strong>ãƒ—ãƒ­ã¯ä¿é™ºã‚’å£²ã‚Šã¾ã™</strong>ã€‚ãƒãƒ•ã‚§ãƒƒãƒˆã®ã‚ˆã†ã«è€ƒãˆã¾ã—ã‚‡ã†ï¼š",
                sellPutQuote: "ã€Œã“ã®æ ªã‚’è²·ã„ãŸã„ãŒã€ä»Šã¯é«˜ã™ãã‚‹ã€‚ã‚‚ã—$90ã¾ã§ä¸‹ãŒã£ãŸã‚‰ã€å…¨åŠ›ã§è²·ã†ã€‚ã€",
                sellPutLogic: "$90ã®Putã‚’å£²ã‚Šã€ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã‚’å—ã‘å–ã‚‹ã€‚<br>1. <strong>$90ä»¥ä¸Š:</strong> ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä¸¸å„²ã‘ã€‚<br>2. <strong>$90ã«ä¸‹è½:</strong> $90ã§æ ªã‚’è²·ã† (ç›®æ¨™ä¾¡æ ¼) - ãƒ—ãƒ¬ãƒŸã‚¢ãƒ åˆ†ã®å‰²å¼•ã€‚",
                sellPutChartTitle: "å–å¾—ã‚³ã‚¹ãƒˆã®æ¯”è¼ƒ",
                sellPutChartCaption: "Sell Put = è£œåŠ©é‡‘ä»˜ãã®æŒ‡å€¤æ³¨æ–‡",
                rrTitle: "ç©¶æ¥µã®æˆ¦ç•¥: Risk Reversal",
                rrSubtitle: "ã‚¿ãƒ€ã§ã‚¨ãƒ³ãƒˆãƒªãƒ¼ï¼Ÿ<br><strong>ãƒ­ã‚¸ãƒƒã‚¯ï¼š</strong> ã€Œè²·ã†ç¾©å‹™ã€(Sell Put) ã§å¾—ãŸé‡‘ã§ã€ã€Œè²·ã†æ¨©åˆ©ã€(Buy Call) ã‚’è²·ã†ã€‚",
                rrStep1: "ä¸‹è½ä¿é™ºã‚’å£²ã‚‹<br>ã€Œ97.5ä»¥ä¸‹ãªã‚‰è²·ã†ã‚ˆã€",
                rrStep1Profit: "+ ãƒ—ãƒ¬ãƒŸã‚¢ãƒ å—å–",
                rrStep2: "ä¸Šæ˜‡ç›Šã‚’è²·ã†<br>ã€Œ115è¶…ãˆãŸã‚‰åˆ©ç›Šã€",
                rrStep2Cost: "- ãƒ—ãƒ¬ãƒŸã‚¢ãƒ æ”¯æ‰•",
                rrSummaryTitle: "æˆ¦ç•¥ã¾ã¨ã‚",
                rrSummaryWin: "<strong>é«˜é¨°:</strong> æ ªä¾¡ > 115ã€‚Callã‚’æŒã£ã¦ã„ã‚‹ã®ã§åˆ©ç›Šç„¡é™å¤§ã€‚",
                rrSummaryDraw: "<strong>æ¨ªã°ã„:</strong> 97.5 ã€œ 115ã€‚æç›Šåˆ†å²ï¼ˆãƒ—ãƒ¬ãƒŸã‚¢ãƒ ç›¸æ®ºï¼‰ã€‚å®‰å…¨ãƒãƒƒãƒ•ã‚¡ã‚ã‚Šã€‚",
                rrSummaryLose: "<strong>æš´è½:</strong> æ ªä¾¡ < 97.5ã€‚97.5ã§æ ªã‚’è²·ã†ç¾©å‹™ã€‚ã§ã‚‚ãã‚Œã¯å…ƒã€…ã®ã€ŒæŠ¼ã—ç›®è²·ã„ã€ç›®æ¨™ä¾¡æ ¼ã§ã™ã€‚",
                quizTitle: "âœ¨ Gemini AI ãƒãƒ£ãƒ¬ãƒ³ã‚¸",
                quizSubtitle: "Risk Reversalã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã¾ã—ãŸã‹ï¼ŸAIãŒãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚",
                quizBtn: "ã‚¯ã‚¤ã‚ºã‚’ç”Ÿæˆ",
                quizLoading: "å‡ºé¡Œä¸­...",
                chatTitle: "Gemini è¬›å¸«",
                chatWelcome: "ã“ã‚“ã«ã¡ã¯ï¼AIã‚ªãƒ—ã‚·ãƒ§ãƒ³è¬›å¸«ã§ã™ã€‚Callã€Putã€Risk Reversalã«ã¤ã„ã¦ä½•ã§ã‚‚èã„ã¦ãã ã•ã„ï¼",
                chatPlaceholder: "è³ªå•ã‚’å…¥åŠ›...",
                askAiBtn: "AIè¬›å¸«ã«è³ªå•",
                // Charts Data
                chartCaloriesLabel: "æ‘‚å–ã‚«ãƒ­ãƒªãƒ¼ (kcal)",
                chartCaloriesTitle: "éé£ŸãŒç‰½å¼•ã™ã‚‹ã‚¸ãƒ éœ€è¦",
                chartCallLabel: "æç›Šé¡ ($)",
                chartCallTitle: "Call Payoff: ä¸ŠãŒã‚‹ã»ã©å„²ã‹ã‚‹",
                chartPutLabels: ["ä¿è­·ãªã—", "Putä¿è­·ã‚ã‚Š"],
                chartPutLabel: "æš´è½æ™‚ã®æå¤± ($)",
                chartPutTitle: "æ ªä¾¡ãŒ $100 -> $50 ã«æš´è½ã—ãŸå ´åˆ",
                chartSellPutLabels: ["ç¾ç‰©è²·ã„", "Putå£²ã‚Šã‚¨ãƒ³ãƒˆãƒªãƒ¼"],
                chartSellPutLabel: "å–å¾—ã‚³ã‚¹ãƒˆ ($)",
                chartSellPutTitle: "ãƒãƒ•ã‚§ãƒƒãƒˆæµã®å‰²å¼•ã‚¨ãƒ³ãƒˆãƒªãƒ¼",
                chartRRLabel: "Risk Reversal æç›Š",
                chartRRTitle: "ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ï¼šä¸‹ãŒã‚Œã°è²·ã„ã€ä¸ŠãŒã‚Œã°çˆ†ç›Šã€ä¸­é–“ã¯é™è¦³"
            }
        };

        // --- GEMINI API CONFIGURATION ---
        const apiKey = ""; // System provides this at runtime
        let currentLang = 'zh';

        const systemPrompts = {
            zh: {
                tutor: "ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„é‡‘èæœŸæƒå¯¼å¸ˆ 'Gemini'ï¼Œæ­£åœ¨ä¸ºåˆå­¦è€…è®²è§£ã€Šä»é›¶å¼€å§‹å­¦æœŸæƒã€‹çš„è¯¾ç¨‹ã€‚ä½ çš„è¯­è¨€é£æ ¼æ¸©æš–ã€ä¸“ä¸šä¸”å¹½é»˜ï¼Œå–„äºä½¿ç”¨æ¯”å–»ï¼ˆå¦‚ä¹°æˆ¿å®šé‡‘æ¯”å–»Callï¼Œè½¦é™©æ¯”å–»Putï¼‰ã€‚å›ç­”è¯·ä¿æŒç®€ç»ƒï¼ˆ100å­—ä»¥å†…ï¼‰ï¼Œé‡ç‚¹è§£é‡Šç”¨æˆ·å…³äº Call, Put, Sell Put, Risk Reversal ç­‰æ¦‚å¿µçš„ç–‘æƒ‘ã€‚è¯·ç”¨ä¸­æ–‡å›ç­”ã€‚",
                quiz: "ä½ æ˜¯ä¸€ä¸ªæœŸæƒè€ƒè¯•å‡ºé¢˜æœºã€‚è¯·æ ¹æ®'Risk Reversal'ç­–ç•¥ï¼ˆSell Put + Buy Callï¼‰ç”Ÿæˆä¸€é“å•é¡¹é€‰æ‹©é¢˜ã€‚é¢˜ç›®è¦è€ƒå¯Ÿç”¨æˆ·å¯¹'å¦‚æœè‚¡ä»·ä¸‹è·Œä¼šå‘ç”Ÿä»€ä¹ˆ'æˆ–è€…'å¦‚æœè‚¡ä»·å¤§æ¶¨ä¼šå‘ç”Ÿä»€ä¹ˆ'çš„ç†è§£ã€‚è¯·ç›´æ¥è¿”å› Markdown æ ¼å¼ï¼ŒåŒ…å«ï¼š\n1. **é¢˜ç›®**\n2. é€‰é¡¹ A, B, C\n3. **ç­”æ¡ˆä¸è§£æ**ï¼ˆé»˜è®¤æŠ˜å æˆ–åœ¨æœ€åæ˜¾ç¤ºï¼‰ã€‚ä¸è¦ä½¿ç”¨ JSONã€‚è¯·ç”¨ä¸­æ–‡å‡ºé¢˜ã€‚"
            },
            en: {
                tutor: "You are a professional financial options tutor named 'Gemini', teaching a 'Zero to Hero Options' course. Your style is warm, professional, and humorous, using metaphors (e.g., House Deposit for Call, Car Insurance for Put). Keep answers concise (under 100 words). Explain Call, Put, Sell Put, Risk Reversal concepts clearly. Please answer in English.",
                quiz: "You are an options exam generator. Generate a multiple-choice question based on the 'Risk Reversal' strategy (Sell Put + Buy Call). Test the user's understanding of what happens if the stock crashes or rallies. Return strictly Markdown format containing: \n1. **Question**\n2. Options A, B, C\n3. **Answer & Explanation** (Hidden or at the end). Do not use JSON. Please generate in English."
            },
            ja: {
                tutor: "ã‚ãªãŸã¯ã€Œã‚¼ãƒ­ã‹ã‚‰å§‹ã‚ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³å–å¼•ã€ã‚³ãƒ¼ã‚¹ã‚’æ•™ãˆã‚‹ãƒ—ãƒ­ã®é‡‘èã‚ªãƒ—ã‚·ãƒ§ãƒ³è¬›å¸« 'Gemini' ã§ã™ã€‚ã‚¹ã‚¿ã‚¤ãƒ«ã¯æ¸©ã‹ãã€å°‚é–€çš„ã§ã€ãƒ¦ãƒ¼ãƒ¢ãƒ©ã‚¹ã«ï¼ˆä¾‹ï¼šCallã¯å®¶ã®æ‰‹ä»˜é‡‘ã€Putã¯è‡ªå‹•è»Šä¿é™ºï¼‰ã€‚å›ç­”ã¯ç°¡æ½”ã«ï¼ˆ200æ–‡å­—ä»¥å†…ï¼‰ã€‚Callã€Putã€Sell Putã€Risk Reversalã®æ¦‚å¿µã‚’æ˜ç¢ºã«èª¬æ˜ã—ã¦ãã ã•ã„ã€‚æ—¥æœ¬èªã§å›ç­”ã—ã¦ãã ã•ã„ã€‚",
                quiz: "ã‚ãªãŸã¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³å–å¼•ã®è©¦é¨“ä½œæˆæ©Ÿã§ã™ã€‚ã€ŒRisk Reversalã€æˆ¦ç•¥ï¼ˆSell Put + Buy Callï¼‰ã«åŸºã¥ã„ã¦å¤šè‚¢é¸æŠå•é¡Œã‚’1ã¤ä½œæˆã—ã¦ãã ã•ã„ã€‚æ ªä¾¡ãŒæš´è½ã¾ãŸã¯é«˜é¨°ã—ãŸå ´åˆã«ä½•ãŒèµ·ã“ã‚‹ã‹ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚JSONã¯ä½¿ç”¨ã›ãšã€ä»¥ä¸‹ã®Markdownå½¢å¼ã§è¿”ã—ã¦ãã ã•ã„ï¼š\n1. **å•é¡Œ**\n2. é¸æŠè‚¢ A, B, C\n3. **æ­£è§£ã¨è§£èª¬**ï¼ˆæŠ˜ã‚ŠãŸãŸã‚€ã‹æœ€å¾Œã«è¡¨ç¤ºï¼‰ã€‚æ—¥æœ¬èªã§ä½œæˆã—ã¦ãã ã•ã„ã€‚"
            }
        };

        async function callGemini(prompt, systemInstruction = "") {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: systemInstruction }] }
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || (currentLang === 'zh' ? "æŠ±æ­‰ï¼Œæˆ‘ç°åœ¨æ— æ³•å›ç­”ï¼Œè¯·ç¨åå†è¯•ã€‚" : "Sorry, I cannot answer right now.");
            } catch (error) {
                console.error("Gemini API Error:", error);
                return currentLang === 'zh' ? "è¿æ¥ AI æœåŠ¡å‡ºé”™ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ– API Keyã€‚" : "Connection error. Please check API Key.";
            }
        }

        // --- LANGUAGE SWITCHING LOGIC ---
        const languageSelector = document.getElementById('languageSelector');
        
        // Store chart instances globally to update them
        const charts = {};

        function updateLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];

            // 1. Update Text Content
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[key]) {
                    el.innerHTML = t[key]; // Use innerHTML to support bold tags
                }
            });

            // 2. Update Placeholders
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if (t[key]) el.placeholder = t[key];
            });

            // 3. Update Charts
            if (charts.calories) {
                charts.calories.data.datasets[0].label = t.chartCaloriesLabel;
                charts.calories.options.plugins.title.text = splitLabel(t.chartCaloriesTitle);
                charts.calories.update();
            }
            if (charts.call) {
                charts.call.data.datasets[0].label = t.chartCallLabel;
                charts.call.options.plugins.title.text = splitLabel(t.chartCallTitle);
                charts.call.update();
            }
            if (charts.put) {
                charts.put.data.labels = t.chartPutLabels.map(l => splitLabel(l));
                charts.put.data.datasets[0].label = t.chartPutLabel;
                charts.put.options.plugins.title.text = splitLabel(t.chartPutTitle);
                charts.put.update();
            }
            if (charts.sellPut) {
                charts.sellPut.data.labels = t.chartSellPutLabels.map(l => splitLabel(l));
                charts.sellPut.data.datasets[0].label = t.chartSellPutLabel;
                charts.sellPut.options.plugins.title.text = splitLabel(t.chartSellPutTitle);
                charts.sellPut.update();
            }
            if (charts.rr) {
                charts.rr.data.datasets[0].label = t.chartRRLabel;
                charts.rr.options.plugins.title.text = splitLabel(t.chartRRTitle);
                charts.rr.update();
            }

            // 4. Update Chat Welcome Message if Chat is Empty (Optional)
            // Ideally we don't wipe chat history, but we can reset the welcome message logic if needed.
        }

        languageSelector.addEventListener('change', (e) => {
            updateLanguage(e.target.value);
        });

        // --- CHAT WIDGET LOGIC ---
        const toggleChatBtn = document.getElementById('toggleChatBtn');
        const closeChatBtn = document.getElementById('closeChatBtn');
        const chatWindow = document.getElementById('chatWindow');
        const chatForm = document.getElementById('chatForm');
        const userQuery = document.getElementById('userQuery');
        const chatMessages = document.getElementById('chatMessages');

        function toggleChat() {
            chatWindow.classList.toggle('hidden');
        }

        function appendMessage(text, isUser) {
            const div = document.createElement('div');
            div.className = `flex gap-2 ${isUser ? 'justify-end' : ''}`;
            
            const bubble = document.createElement('div');
            bubble.className = `p-3 rounded-lg max-w-[85%] text-sm ${isUser ? 'bg-pink-500 text-white rounded-tr-none' : 'bg-indigo-100 text-indigo-800 rounded-tl-none prose'}`;
            
            if (isUser) {
                bubble.textContent = text;
            } else {
                bubble.innerHTML = marked.parse(text);
            }
            
            div.appendChild(bubble);
            chatMessages.appendChild(div);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        toggleChatBtn.addEventListener('click', toggleChat);
        closeChatBtn.addEventListener('click', toggleChat);

        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const query = userQuery.value.trim();
            if (!query) return;

            // User Message
            appendMessage(query, true);
            userQuery.value = '';

            // Loading state
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'flex gap-2';
            loadingDiv.innerHTML = `<div class="bg-gray-200 text-gray-500 p-3 rounded-lg rounded-tl-none text-xs animate-pulse">AI...</div>`;
            chatMessages.appendChild(loadingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // API Call with Language-Specific System Prompt
            const responseText = await callGemini(query, systemPrompts[currentLang].tutor);
            
            // Remove loading and show response
            chatMessages.removeChild(loadingDiv);
            appendMessage(responseText, false);
        });

        // --- QUIZ GENERATOR LOGIC ---
        const generateQuizBtn = document.getElementById('generateQuizBtn');
        const quizContainer = document.getElementById('quizContainer');

        generateQuizBtn.addEventListener('click', async () => {
            quizContainer.classList.remove('hidden');
            const t = translations[currentLang];
            quizContainer.innerHTML = `
                <div class="animate-pulse flex space-x-4">
                    <div class="flex-1 space-y-4 py-1">
                        <div class="h-4 bg-white/20 rounded w-3/4"></div>
                        <div class="space-y-2">
                            <div class="h-4 bg-white/20 rounded"></div>
                            <div class="h-4 bg-white/20 rounded w-5/6"></div>
                        </div>
                    </div>
                </div>
                <p class="text-center text-sm text-indigo-300 mt-4">${t.quizLoading}</p>
            `;
            
            // Generate Quiz with Language-Specific Prompt
            const quizContent = await callGemini("Generate a Risk Reversal Quiz", systemPrompts[currentLang].quiz);
            
            quizContainer.innerHTML = `
                <div class="prose prose-invert max-w-none">
                    ${marked.parse(quizContent)}
                </div>
                <button onclick="document.getElementById('quizContainer').classList.add('hidden')" class="mt-4 text-xs text-indigo-300 hover:text-white underline">âœ•</button>
            `;
        });

        // --- UTILITY: Label Splitting Logic (16 chars) ---
        function splitLabel(label) {
            if (label.length <= 16) return label;
            const words = label.split(' ');
            const lines = [];
            let currentLine = words[0];

            for (let i = 1; i < words.length; i++) {
                if ((currentLine + " " + words[i]).length <= 16) {
                    currentLine += " " + words[i];
                } else {
                    lines.push(currentLine);
                    currentLine = words[i];
                }
            }
            lines.push(currentLine);
            return lines;
        }

        // --- GLOBAL CHART OPTIONS ---
        Chart.defaults.font.family = "'Noto Sans SC', 'Noto Sans JP', 'Roboto', sans-serif";
        Chart.defaults.color = '#4B5563';
        
        const commonTooltip = {
            callbacks: {
                title: function(tooltipItems) {
                    const item = tooltipItems[0];
                    let label = item.chart.data.labels[item.dataIndex];
                    if (Array.isArray(label)) {
                        return label.join(' ');
                    } else {
                        return label;
                    }
                }
            }
        };

        const responsiveConfig = {
            maintainAspectRatio: false,
            responsive: true,
            plugins: {
                legend: { position: 'bottom' },
                tooltip: commonTooltip
            }
        };

        // --- CHART 1: CALORIES vs STOCK (Hook) ---
        const ctxCalories = document.getElementById('caloriesChart').getContext('2d');
        charts.calories = new Chart(ctxCalories, {
            type: 'bar',
            data: {
                labels: ['æ—¥å¸¸æ™šé¤å¡è·¯é‡Œ', 'æ„Ÿæ©èŠ‚æ™šé¤å¡è·¯é‡Œ'],
                datasets: [{
                    label: translations.zh.chartCaloriesLabel,
                    data: [800, 3000],
                    backgroundColor: ['#9CA3AF', '#EC4899'], // Gray vs Pink
                    borderRadius: 8
                }]
            },
            options: {
                ...responsiveConfig,
                plugins: {
                    ...responsiveConfig.plugins,
                    title: {
                        display: true,
                        text: splitLabel(translations.zh.chartCaloriesTitle)
                    }
                },
                scales: {
                    y: { beginAtZero: true, title: {display: true, text: 'Kcal'} }
                }
            }
        });

        // --- CHART 2: CALL OPTION PAYOFF (Line) ---
        // Scenario: Buy Call Strike $100, Premium $5.
        // Range: 80 to 150
        const callPrices = [80, 90, 100, 105, 120, 150];
        const callPayoff = callPrices.map(p => {
            // Profit = Max(Price - Strike, 0) - Premium
            return Math.max(p - 100, 0) - 5;
        });

        const ctxCall = document.getElementById('callPayoffChart').getContext('2d');
        charts.call = new Chart(ctxCall, {
            type: 'line',
            data: {
                labels: callPrices.map(p => `$${p}`),
                datasets: [{
                    label: translations.zh.chartCallLabel,
                    data: callPayoff,
                    borderColor: '#4F46E5', // Indigo
                    backgroundColor: 'rgba(79, 70, 229, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.1,
                    pointBackgroundColor: callPayoff.map(v => v >= 0 ? '#10B981' : '#EF4444'),
                    pointRadius: 5
                }]
            },
            options: {
                ...responsiveConfig,
                plugins: {
                    ...responsiveConfig.plugins,
                    title: { display: true, text: splitLabel(translations.zh.chartCallTitle) },
                    annotation: {
                        annotations: {
                            line1: {
                                type: 'line',
                                yMin: 0,
                                yMax: 0,
                                borderColor: 'black',
                                borderWidth: 1,
                                borderDash: [5, 5]
                            }
                        }
                    }
                }
            }
        });

        // --- CHART 3: PUT PROTECTION (Bar Comparison) ---
        // Scenario: Stock crashes from 100 to 50.
        // Portfolio A: No Put. Loss = 50.
        // Portfolio B: With Put (Strike 100, Cost 5). Loss = Premium (5).
        const ctxPut = document.getElementById('putProtectionChart').getContext('2d');
        charts.put = new Chart(ctxPut, {
            type: 'bar',
            data: {
                labels: [splitLabel('è£¸å¥”æŒæœ‰ (æ— ä¿æŠ¤)'), splitLabel('æŒæœ‰ Put ä¿æŠ¤')],
                datasets: [{
                    label: translations.zh.chartPutLabel,
                    data: [-50, -5],
                    backgroundColor: ['#EF4444', '#10B981'], // Red vs Greenish
                    borderRadius: 6
                }]
            },
            options: {
                ...responsiveConfig,
                indexAxis: 'y', // Horizontal Bar
                plugins: {
                    ...responsiveConfig.plugins,
                    title: { display: true, text: splitLabel(translations.zh.chartPutTitle) }
                }
            }
        });

        // --- CHART 4: SELL PUT COST BASIS (Grouped Bar) ---
        // Scenario: Target Buy Price. Current $100.
        // Method A: Buy Now. Cost $100.
        // Method B: Sell Put Strike $90, Premium $2. Effective Cost if exercised = 90 - 2 = 88.
        const ctxSellPut = document.getElementById('sellPutChart').getContext('2d');
        charts.sellPut = new Chart(ctxSellPut, {
            type: 'bar',
            data: {
                labels: [splitLabel('ç›´æ¥ä¹°å…¥ç°ä»·è‚¡ç¥¨'), splitLabel('å–å‡º Put æ¥ç›˜')],
                datasets: [{
                    label: translations.zh.chartSellPutLabel,
                    data: [100, 88],
                    backgroundColor: ['#6B7280', '#06B6D4'], // Gray vs Cyan
                    barThickness: 50,
                    borderRadius: 4
                }]
            },
            options: {
                ...responsiveConfig,
                scales: {
                    y: { min: 80, title: {display: true, text: 'æ¯è‚¡æˆæœ¬ ($)'} }
                },
                plugins: {
                    ...responsiveConfig.plugins,
                    title: { display: true, text: splitLabel(translations.zh.chartSellPutTitle) }
                }
            }
        });

        // --- CHART 5: RISK REVERSAL PAYOFF (Line) ---
        // Leg 1: Sell Put 97.5 (Receive 2)
        // Leg 2: Buy Call 115 (Pay 2)
        // Net Premium: 0
        // P/L Logic:
        // if Price < 97.5: Loss = Price - 97.5 (Obligated to buy at 97.5)
        // if 97.5 <= Price <= 115: 0 (Put expires worthless, Call expires worthless)
        // if Price > 115: Profit = Price - 115 (Call in the money)

        const rrPrices = [80, 90, 97.5, 105, 110, 115, 125, 140];
        const rrPayoff = rrPrices.map(p => {
            let val = 0;
            // Put Leg (Short 97.5)
            if (p < 97.5) val -= (97.5 - p);
            // Call Leg (Long 115)
            if (p > 115) val += (p - 115);
            return val;
        });

        const ctxRR = document.getElementById('riskReversalChart').getContext('2d');
        charts.rr = new Chart(ctxRR, {
            type: 'line',
            data: {
                labels: rrPrices.map(p => `$${p}`),
                datasets: [{
                    label: translations.zh.chartRRLabel,
                    data: rrPayoff,
                    borderColor: '#8B5CF6', // Violet
                    borderWidth: 3,
                    fill: {
                        target: 'origin',
                        above: 'rgba(16, 185, 129, 0.2)',   // Green area (Profit)
                        below: 'rgba(239, 68, 68, 0.2)'     // Red area (Loss/Buy Stock)
                    },
                    tension: 0.2,
                    pointBackgroundColor: '#FFFFFF',
                    pointBorderColor: '#8B5CF6',
                    pointRadius: 6
                }]
            },
            options: {
                ...responsiveConfig,
                plugins: {
                    ...responsiveConfig.plugins,
                    title: { display: true, text: splitLabel(translations.zh.chartRRTitle) },
                    annotation: {
                        annotations: {
                            lineZero: {
                                type: 'line',
                                yMin: 0,
                                yMax: 0,
                                borderColor: 'gray',
                                borderWidth: 1
                            }
                        }
                    }
                },
                scales: {
                    y: { title: {display: true, text: 'ç›ˆäº ($)'} }
                }
            }
        });

    </script>
</body>
</html>